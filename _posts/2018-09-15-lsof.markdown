---
layout: post
title:  "lsof Notebook"
date:   2018-09-15
author: "Haani Niyaz"
tags: 
 - lsof
 - tutorial
---


## Getting info about the Network


### lsof `-i` Options

The following is a snippet from the `lsof` man pages. It describes the syntax available when using the `-i` option.

{% highlight bash %}
[46][protocol][@hostname|hostaddr][:service|port]
{% endhighlight %}

Where:

`46` specifies the IP version, IPv4 or IPv6
          that applies to the following address.
          '6' may be be specified only if the UNIX
          dialect supports IPv6.  If neither '4' nor
          '6' is specified, the following address
          applies to all IP versions.

`protocol` is a protocol name - TCP, UDP

`hostname` is an Internet host name.  Unless a
          specific IP version is specified, open
          network files associated with host names
          of all versions will be selected.

`hostaddr` is a numeric Internet IPv4 address in
          dot form; or an IPv6 numeric address in
          colon form, enclosed in brackets, if the
          UNIX dialect supports IPv6.  When an IP
          version is selected, only its numeric
          addresses may be specified.

`service` is an /etc/services name - e.g., smtp -
          or a list of them.

`port` is a port number, or a list of them.


### TCP Socket States


`LISTEN`  

Wait for remote machine end to contact us

`ESTABLISHED` 

Ready for communication

`CLOSE WAIT` 

Remote machine has already closed the connection, but the local program has received a termination request and acknowledged it but is pending an active close.


#### TCP connection to a host and port

{% highlight bash %}

$ lsof -i4TCP@<hostname>:<port>

{% endhighlight %}

#### Only show PID for TCP connections

{% highlight bash %}

$ lsof -iTCP -t

{% endhighlight %}


#### TCP connections where the socket state is 'LISTEN'

{% highlight bash %}

 # -s p:s  exclude(^)|select protocol (p = TCP|UDP) states by name(s).
$ lsof -iTCP -sTCP:LISTEN

{% endhighlight %}


#### All TCP connection states except for 'LISTEN'

{% highlight bash %}

# -s p:s  exclude(^)|select protocol (p = TCP|UDP) states by name(s).
$ lsof -iTCP -sTCP:^LISTEN

{% endhighlight %}

#### See a what a given `COMMAND` is doing

{% highlight bash %}

$ lsof -iTCP -c <name>

{% endhighlight %}


#### See a what a given process is doing

{% highlight bash %}

$ lsof iTCP -p <pid>

{% endhighlight %}