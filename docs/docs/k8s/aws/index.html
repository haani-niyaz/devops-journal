<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="AWS #  Testing AWS access inside an EKS Pod with IRSA enabled #  kubectl apply -f - <<EOF apiVersion: v1 kind: Pod metadata: name: awscli namespace: ngapps-ssp-backend spec: serviceAccountName: crowd-adapter containers: - name: awscli image: banst/awscli command: - sleep - &#34;3600&#34; imagePullPolicy: IfNotPresent restartPolicy: Always EOF Connect to Pod and run the following:
aws sts assume-role-with-web-identity \  --role-arn $AWS_ROLE_ARN \  --role-session-name mysession \  --web-identity-token file://$AWS_WEB_IDENTITY_TOKEN_FILE \  --duration-seconds 1000 > /tmp/irp-cred."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="AWS"><meta property="og:description" content="AWS #  Testing AWS access inside an EKS Pod with IRSA enabled #  kubectl apply -f - <<EOF apiVersion: v1 kind: Pod metadata: name: awscli namespace: ngapps-ssp-backend spec: serviceAccountName: crowd-adapter containers: - name: awscli image: banst/awscli command: - sleep - &#34;3600&#34; imagePullPolicy: IfNotPresent restartPolicy: Always EOF Connect to Pod and run the following:
aws sts assume-role-with-web-identity \  --role-arn $AWS_ROLE_ARN \  --role-session-name mysession \  --web-identity-token file://$AWS_WEB_IDENTITY_TOKEN_FILE \  --duration-seconds 1000 > /tmp/irp-cred."><meta property="og:type" content="article"><meta property="og:url" content="https://haani-niyaz.github.io/devops-journal/docs/k8s/aws/"><title>AWS | DevOps Journal</title><link rel=manifest href=/devops-journal/manifest.json><link rel=icon href=/devops-journal/favicon.png type=image/x-icon><link rel=stylesheet href=/devops-journal/book.min.e40449dffab36960ca7d6bac529d52d7ab9f9d230ffe5de1799e29cb61bc0cb7.css integrity="sha256-5ARJ3/qzaWDKfWusUp1S16ufnSMP/l3heZ4py2G8DLc="><script defer src=/devops-journal/en.search.min.b62aff785f47e8798c2c2e7b8fccb6426e110ebdf1b3f55ed2efca6320e9dd68.js integrity="sha256-tir/eF9H6HmMLC57j8y2Qm4RDr3xs/Ve0u/KYyDp3Wg="></script></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/devops-journal><span>DevOps Journal</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><a href=/devops-journal/docs/example/>Example Site</a><ul><li><a href=/devops-journal/docs/example/table-of-contents/>Table of Contents</a><ul><li><a href=/devops-journal/docs/example/table-of-contents/with-toc/>With ToC</a></li><li><a href=/devops-journal/docs/example/table-of-contents/without-toc/>Without ToC</a></li></ul></li><li><a href=/devops-journal/docs/example/collapsed/ class=collapsed>Collapsed</a></li></ul></li><li><span>Aws</span><ul><li><a href=/devops-journal/docs/aws/cloudformation/>Cloudformation</a></li><li><a href=/devops-journal/docs/aws/ec2/>EC2</a></li><li><a href=/devops-journal/docs/aws/eks/ class=collapsed>EKS</a></li><li><a href=/devops-journal/docs/aws/iam/>IAM</a></li><li><a href=/devops-journal/docs/aws/route53/>Route53</a></li><li><a href=/devops-journal/docs/aws/vpc/>VPC</a></li></ul></li><li class=book-section-flat><span>Azure</span><ul><li><a href=/devops-journal/docs/azure/active-directory/>Active Directory</a></li></ul></li><li class=book-section-flat><span>Go</span><ul><li><a href=/devops-journal/docs/go/journal/>Journal</a></li></ul></li><li class=book-section-flat><span>Grpc</span><ul><li><a href=/devops-journal/docs/grpc/examples/>Examples</a></li><li><a href=/devops-journal/docs/grpc/faq/>FAQ</a></li></ul></li><li class=book-section-flat><span>Istio</span><ul><li><a href=/devops-journal/docs/istio/authorization-policies/>Authorization Policies</a></li><li><a href=/devops-journal/docs/istio/references/>References</a></li></ul></li><li class=book-section-flat><span>K8s</span><ul><li><a href=/devops-journal/docs/k8s/quickstart/>Quickstart</a></li><li><a href=/devops-journal/docs/k8s/aws/ class=active>AWS</a></li></ul></li><li class=book-section-flat><span>Shortcodes</span><ul><li><a href=/devops-journal/docs/shortcodes/buttons/>Buttons</a></li><li><a href=/devops-journal/docs/shortcodes/columns/>Columns</a></li><li><a href=/devops-journal/docs/shortcodes/details/>Details</a></li><li><a href=/devops-journal/docs/shortcodes/expand/>Expand</a></li><li><a href=/devops-journal/docs/shortcodes/hints/>Hints</a></li><li><a href=/devops-journal/docs/shortcodes/katex/>Katex</a></li><li><a href=/devops-journal/docs/shortcodes/mermaid/>Mermaid</a></li><li><a href=/devops-journal/docs/shortcodes/section/ class=collapsed>Section</a></li><li><a href=/devops-journal/docs/shortcodes/tabs/>Tabs</a></li></ul></li></ul><ul><li><a href=/devops-journal/posts/>Blog</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/devops-journal/svg/menu.svg class=book-icon alt=Menu></label>
<strong>AWS</strong>
<label for=toc-control><img src=/devops-journal/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><input type=checkbox class=hidden id=toc-control><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#testing-aws-access-inside-an-eks-pod-with-irsa-enabled>Testing AWS access inside an EKS Pod with IRSA enabled</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=aws>AWS
<a class=anchor href=#aws>#</a></h1><h3 id=testing-aws-access-inside-an-eks-pod-with-irsa-enabled>Testing AWS access inside an EKS Pod with IRSA enabled
<a class=anchor href=#testing-aws-access-inside-an-eks-pod-with-irsa-enabled>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl apply -f - <span style=color:#e6db74>&lt;&lt;EOF
</span><span style=color:#e6db74>apiVersion: v1
</span><span style=color:#e6db74>kind: Pod
</span><span style=color:#e6db74>metadata:
</span><span style=color:#e6db74>  name: awscli
</span><span style=color:#e6db74>  namespace: ngapps-ssp-backend
</span><span style=color:#e6db74>spec:
</span><span style=color:#e6db74>  serviceAccountName: crowd-adapter 
</span><span style=color:#e6db74>  containers:
</span><span style=color:#e6db74>  - name: awscli
</span><span style=color:#e6db74>    image: banst/awscli
</span><span style=color:#e6db74>    command:
</span><span style=color:#e6db74>      - sleep
</span><span style=color:#e6db74>      - &#34;3600&#34;
</span><span style=color:#e6db74>    imagePullPolicy: IfNotPresent
</span><span style=color:#e6db74>  restartPolicy: Always
</span><span style=color:#e6db74>EOF</span></code></pre></div><p>Connect to Pod and run the following:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>aws sts assume-role-with-web-identity <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span> --role-arn $AWS_ROLE_ARN <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span> --role-session-name mysession <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span> --web-identity-token file://$AWS_WEB_IDENTITY_TOKEN_FILE <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span> --duration-seconds <span style=color:#ae81ff>1000</span> &gt; /tmp/irp-cred.txt</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>export AWS_ACCESS_KEY_ID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>cat /tmp/irp-cred.txt | jq -r <span style=color:#e6db74>&#34;.Credentials.AccessKeyId&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
export AWS_SECRET_ACCESS_KEY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>cat /tmp/irp-cred.txt | jq -r <span style=color:#e6db74>&#34;.Credentials.SecretAccessKey&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
export AWS_SESSION_TOKEN<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>cat /tmp/irp-cred.txt | jq -r <span style=color:#e6db74>&#34;.Credentials.SessionToken&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
<span style=color:#75715e># Match your region</span>
export AWS_DEFAULT_REGION<span style=color:#f92672>=</span>ap-southeast-2</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>aws sqs list-queues</code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><ul><li><a href=#testing-aws-access-inside-an-eks-pod-with-irsa-enabled>Testing AWS access inside an EKS Pod with IRSA enabled</a></li></ul></li></ul></nav></aside></main></body></html>